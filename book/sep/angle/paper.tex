%\shortnote

\lefthead{Fomel \& Prucha}
\righthead{Angle-gather time migration}
\footer{SEP--100}

\published{SEP report, 100, 141-150 (1999)}
\title{Angle-gather time migration}

\email{sergey@sep.stanford.edu, marie@sep.stanford.edu}
%\keywords{time migration, AVO}

\author{Sergey Fomel and Marie Prucha}
\maketitle

\begin{abstract} 
Angle-gather migration creates seismic images for different
  reflection angles at the reflector. We formulate an angle-gather
  time migration algorithm and study its properties. The algorithm
  serves as an educational introduction to the angle gather concept.
  It also looks attractive as a practical alternative to conventional
  common-offset time migration both for velocity analysis and for
  AVO/AVA analysis.
\end{abstract}

\section{Introduction}

Angle-gather migration creates seismic images collected by the
reflection angle at the point of reflection. Major advantages of this
approach are apparent in the case of prestack depth migration. As
shown by \cite{Prucha.sep.100.marie1}, the ray 
pattern of angle-gather migration is significantly different from that
of the conventional common-offset migration. The difference can be
exploited for overcoming illumination difficulties of the conventional
depth migration in complex geological areas.
\par
In this paper, we explore the angle-gather concept in the case of
prestack time migration. The first goal of this study is educational.
Since we can develop the complete mathematical theory of angle-gather
time migration analytically, it is much easier to understand the most
basic properties of the method in the time migration domain. The
second goal is practical. Angle gathers present an attractive tool for
post-migration AVO/AVA studies and velocity analysis, and even the
most basic time migration approach can find a valuable place in the
complete toolbox of seismic imaging.
\par
We start with analyzing the traveltime relations for the basic
Kirchhoff implementation of angle-gather time migration. The analysis
follows Fowler's general approach to prestack time migration methods
\cite[]{SEG-1997-1571}. Next, we derive formulas for the amplitude weighting
and discuss some frequency-domain approaches to angle gathers.
Finally, we present simple synthetic tests of the method and discuss
further research directions.

\section{Traveltime considerations}
\inputdir{XFig}

\sideplot{rays}{width=3in}{Reflection rays in a constant-velocity
  medium: a scheme.}

Let us consider a simple reflection experiment in an effectively
constant-velocity medium, as depicted in Figure~\ref{fig:rays}. The
pair of incident and reflected rays and the line between the source
$s$ and the receiver $r$ form a triangle in space. From the
trigonometry of that triangle we can derive simple relationships among
all the variables of the experiment
\cite[]{Fomel.sep.84.179,Fomel.sep.92.159,SEG-1997-1762}.
\par
Introducing the dip angle $\alpha$ and the reflection angle $\gamma$,
the total reflection traveltime $t$ can be expressed from the law of
sines as
\begin{equation}
  t = {\frac{2 h}{v}}\,
  {\frac{\cos(\alpha+\gamma) + \cos(\alpha-\gamma)}{\sin{2\,\gamma}}} =
  {\frac{2 h}{v}\,\frac{\cos{\alpha}}{\sin{\gamma}}}\;,
\label{eqn:h2t}
\end{equation}
where $v$ is the medium velocity, and $h$ is the half-offset between
the source and the receiver. 
\par
Additionally, by following simple trigonometry, we can connect the
half-offset $h$ with the depth of the reflection point $z$, as
follows:
\begin{equation}
  h = {\frac{z}{2}}\,
  {\frac{\sin{2\,\gamma}}{2\,\cos(\alpha+\gamma)\,\cos(\alpha-\gamma)}} =
  {z\,\frac{\sin{\gamma}\,\cos{\gamma}}{\cos^2{\alpha} - \sin^2{\gamma}}}\;.
\label{eqn:z2h}
\end{equation}
\par
Finally, the horizontal distance between the midpoint $x$ and the
reflection point $\xi$ is
\begin{equation}
  \label{eqn:h2x}
  x - \xi = h\,\frac{\cos(\alpha-\gamma)\,\sin(\alpha+\gamma)\,+\,
    \cos(\alpha+\gamma)\,\sin(\alpha-\gamma)}{\sin{2\,\gamma}} =
  h\,\frac{\sin{\alpha}\,\cos{\alpha}}{\sin{\gamma}\,\cos{\gamma}}
\end{equation}
\par
Equations (\ref{eqn:h2t}--\ref{eqn:h2x}) completely define the
kinematics of angle-gather migration. Regrouping the terms, we can
rewrite the three equations in a more symmetric form:
\begin{eqnarray}
  \label{eqn:t}
  t & = & \frac{2\,z}{v}\,
  \frac{\cos{\alpha}\,\cos{\gamma}}{\cos^2{\alpha} - \sin^2{\gamma}}
  \\ \label{eqn:h}
  h & = & z\,
  \frac{\sin{\gamma}\,\cos{\gamma}}{\cos^2{\alpha} - \sin^2{\gamma}}
  \\ \label{eqn:x}
  x - \xi & = & z\,
  \frac{\sin{\alpha}\,\cos{\alpha}}{\cos^2{\alpha} - \sin^2{\gamma}}
\end{eqnarray}
For completeness, here is the inverse transformation from $t$, $h$,
and $x-\xi$ to $z$, $\gamma$, and $\alpha$:
\begin{eqnarray}
  \label{eqn:z}
  z^2 & = & 
  \frac{
    \left[(v\,t/2)^2 - (x-\xi)^2\right]\,
    \left[(v\,t/2)^2 - h^2\right]
    }{(v\,t/2)^2} 
  \\ \label{eqn:gamma}
  \sin^2{\gamma} & = & 
  \frac{h^2\, \left[(v\,t/2)^2 - (x-\xi)^2\right]}
  {(v\,t/2)^4 - h^2\,(x-\xi)^2}
  \\ \label{eqn:alpha}
  \cos^2{\alpha} & = & 
  \frac{(v\,t/2)^2\, \left[(v\,t/2)^2 - (x-\xi)^2\right]}
  {(v\,t/2)^4 - h^2\,(x-\xi)^2}
\end{eqnarray}
The inverse transformation (\ref{eqn:z}-\ref{eqn:alpha}) can be found
by formally solving system (\ref{eqn:t}-\ref{eqn:x}).
\par
The lines of constant reflection angle $\gamma$ and variable dip angle
$\alpha$ for a given position of a reflection (diffraction) point
$\{z,\xi\}$ have the meaning of summation curves for angle-gather
Kirchhoff migration. The whole range of such curves for all possible
values of $\gamma$ covers the diffraction traveltime surface -
``Cheops' pyramid'' \cite[]{Claerbout.blackwell.85} in the $\{t,x,h\}$
space of seismic reflection data.  As pointed out by
\cite{SEG-1997-1571}, this condition is sufficient for proving the
kinematic validity of the angle-gather approach.  For comparison,
Figure \ref{fig:coffset} shows the diffraction traveltime pyramid from
a diffractor at 0.5 km depth.  The pyramid is composed of
common-offset summation curves of the conventional time migration.
Figure \ref{fig:cangle} shows the same pyramid composed of
constant-$\gamma$ curves of the angle-gather migration.

\inputdir{Math}

\sideplot{coffset}{width=3in}{Traveltime pyramid, composed of
  common-offset summation curves.}

\sideplot{cangle}{width=3in}{Traveltime pyramid, composed of
  common-reflection-angle summation curves.}

\par
The most straightforward Kirchhoff algorithm of angle-gather migration
can be formulated as follows:
\begin{itemize}
\item For each reflection angle $\gamma$ and each dip angle $\alpha$,
  \begin{itemize}
  \item For each output location $\{z,\xi\}$,
    \begin{enumerate}
    \item Find the traveltime $t$, half-offset $h$, and midpoint
      $x$ from formulas (\ref{eqn:t}), (\ref{eqn:h}), and
      (\ref{eqn:x}) respectively.
    \item Stack the input data values into the output.
    \end{enumerate}
  \end{itemize}
\end{itemize}
As follows from equations (\ref{eqn:t}-\ref{eqn:x}), the range of
possible $\alpha$'s should satisfy the condition
\begin{equation}
  \label{eqn:range}
  \cos^2{\alpha} > \sin^2{\gamma}\quad\mbox{or}\quad
  |\alpha| + |\gamma| < \frac{\pi}{2}\;.
\end{equation}
The described algorithm is not the most optimal in terms of the
input/output organization, but it can serve as a basic implementation
of the angle-gather idea. The stacking step requires an appropriate
weighting. We discuss the weighting issues in the next section.

\section{Amplitude considerations}

One simple approach to amplitude weighting for angle-gather migration
is based again on Cheops' pyramid considerations. Stacking along the
pyramid in the data space is a double integration in midpoint and
offset coordinates. Angle-gather migration implies the change of
coordinates from $\{x,h\}$ to $\{\alpha,\gamma\}$. The change of
coordinates leads to weighting the integrand by the following Jacobian
transformation:
\begin{equation}
  \label{eqn:jacob}
  dx\,dh = \left| \det \left(
        \begin{array}{cc}
          \frac{\partial x}{\partial \alpha} & 
          \frac{\partial x}{\partial \gamma} \\
          \frac{\partial h}{\partial \alpha} & 
          \frac{\partial h}{\partial \gamma}
        \end{array}
      \right) \right|\,d\alpha\,d\gamma
\end{equation}
Substituting formulas (\ref{eqn:h}) and (\ref{eqn:x}) into equation
(\ref{eqn:jacob}) gives us the following analytical expression for the
Jacobian weighting:
\begin{equation}
  \label{eqn:ajacob}
  W_{\mbox{J}} = \left| \det \left(
      \begin{array}{cc}
        \frac{\partial x}{\partial \alpha} & 
        \frac{\partial x}{\partial \gamma} \\
        \frac{\partial h}{\partial \alpha} & 
        \frac{\partial h}{\partial \gamma}
      \end{array}
    \right) \right| = 
  \frac{z^2}{\left(\cos{\alpha}^2 - \sin{\gamma}^2\right)^2}
\end{equation}
Weighting (\ref{eqn:ajacob}) should be applied in addition to the
weighting used in common-offset migration. By analyzing formula
(\ref{eqn:ajacob}), we can see that the weight increases with the
reflector depth and peaks where the angles $\alpha$ and $\gamma$
approach condition (\ref{eqn:range}).
\par
The Jacobian weighting approach, however, does not provide physically
meaningful amplitudes, when migrated angle gathers are considered
individually. In order to obtain a physically meaningful amplitude, we
can turn to the asymptotic theory of true-amplitude migration
\cite[]{tam,GEO58-08-11121126,tygel}. The true-amplitude weighting provides an
asymptotic high-frequency amplitude proportional to the reflection
coefficient, with the wave propagation (geometric spreading) effects
removed. The generic true-amplitude weighting formula
\cite[]{Fomel.sep.92.267} transforms in the case of 2-D angle-gather
time migration to the form:
\begin{equation}
  \label{eqn:ta}
  W_{\mbox{TA}} = \frac{1}{\sqrt{2\,\pi}}\,
  \frac{\sqrt{L_s\,L_r}}{v\,\cos{\gamma}}\,
  \left|\frac{\partial^2 L_s}{\partial \xi \partial \gamma} +
    \frac{\partial^2 L_r}{\partial \xi \partial \gamma} 
  \right|\;,  
\end{equation}
where $L_s$ and $L_r$ are the ray lengths from the reflector point to
the source and the receiver respectively. After some heavy algebra,
the true-amplitude expression takes the form
\begin{equation}
  \label{eqn:ta1}
  W_{\mbox{TA}} = \frac{2\,z\,\sin{\alpha}}{\sqrt{2\,\pi} v}\,
  \frac{\cos^2{\alpha} + \sin^2{\gamma}}
  {\left(\cos^2{\alpha} - \sin^2{\gamma}\right)^{5/2}}\;.
\end{equation}
Under the constant-velocity assumption and in high-frequency
asymptotic, this weighting produces an output, proportional to the
reflection coefficient, when applied for creating an angle gather with
the reflection angle $\gamma$. Despite the strong assumptions behind
this approach, it might be useful in practice for post-migration
amplitude-versus-angle studies. Unlike the conventional common-offset
migration, the angle-gather approach produces the output directly in
reflection angle coordinates. One can use the generic true-amplitude
theory \cite[]{Fomel.sep.92.267} for extending formula (\ref{eqn:ta1})
to the 3-D and 2.5-D cases.

\section{Examples}

\input{example}

\section{Frequency-domain considerations}

As pointed out by \cite{Prucha.sep.100.marie1}, the angle gathers
can be conveniently formed in the frequency domain. This conclusion
follows from the simple formula \cite[]{Fomel.sep.92.159}
\begin{equation}
  \label{eqn:freq}
  \tan{\gamma} = \frac{\partial z}{\partial h}\;,
\end{equation}
where $z$ refers to the depth coordinate of the migrated image. In the
frequency-wavenumber domain, formula (\ref{eqn:freq}) takes the
trivial form
\begin{equation}
  \label{eqn:freq1}
  \tan{\gamma} = \frac{k_h}{k_z}\;.
\end{equation}
It indicates that angle gathers can be conveniently formed with the help
of frequency-domain migration algorithms \cite[]{GEO43-01-00230048}.
This interesting opportunity requires further research.

\section{Conclusions}

We have presented an approach to time migration based on angle
gathers. The output of this procedure are migrated angle gathers -
images for constant reflection angles. When stacked together, angle
gathers can produce the same output as the conventional common-offset
gathers. Looking at angle gathers individually opens new possibilities
for amplitude-versus-angle studies and for velocity analysis. 
\par
Our first synthetic tests produced promising results. In the future,
we plan to study the amplitude behavior of angle-gather migration and the
velocity sensitivity more carefully. We also plan to investigate 
the frequency-domain approaches to this method. Initial results indicate
that angle-gather migration is comparable to offset-domain migration for
angles less than the angle at which rays exit the sides of the model, but
further study will hopefully allow us to extract useful information from 
the larger angles as well. Although the major advantages of angle gathers 
lay in the depth migration domain, it is easier to analyze the time migration 
results because of their theoretical simplicity.

%\section{Acknowledgments}

\bibliographystyle{seg}
\bibliography{SEP2,SEG,angle}

%\APPENDIX{A}

%\plot{name}{width=6in,height=}{caption}
%\sideplot{name}{height=1.5in,width=}{caption}
%
%\begin{equation}
%\label{eqn:}
%\end{equation}
%
%\ref{fig:}
%(\ref{eqn:})

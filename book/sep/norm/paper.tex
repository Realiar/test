\lefthead{Fomel \& Bleistein}
\righthead{Offset continuation}
\footer{SEP--92}
\published{Journal of Seismic Exploration, v. 9, 121-130 (2001)}
\title{Amplitude preservation for offset continuation:\\
Confirmation for Kirchhoff data}
%\keywords{amplitudes, continuation, DMO, approximation }


%\noemailaddress
\author{Sergey Fomel\/\footnotemark[1] 
and Norman Bleistein\/\footnotemark[2]}

\footnotetext[1]{\emph{Lawrence Berkeley National Laboratory, 
   1 Cyclotron Road, Mail Stop 50A-1148, 
   Berkeley, CA 94720, USA}}
\footnotetext[2]{\emph{Center for Wave Phenomena,
       Colorado School of Mines, 
       Golden, CO 80401, USA}}

\maketitle
 
\begin{abstract}
Offset continuation (OC) is the operator that transforms common-offset
     seismic reflection data from one offset to another.  Earlier
     papers by the first author presented a partial differential
     equation in midpoint and offset to achieve this transformation.
     The equation was derived from the kinematics of the continuation
     process with no reference to amplitudes. We present here a proof
     that the solution of the OC partial differential equation does
     propagate amplitude properly at all offsets, at least to the same
     order of accuracy as the Kirchhoff approximation.  That is, the
     OC equation provides a solution with the correct traveltime and
     correct leading-order amplitude.  ``Correct amplitude'' in this
     case means that the transformed amplitude exhibits the right
     geometrical spreading and reflection-surface-curvature effects
     for the new offset.  The reflection coefficient of the original
     offset is preserved in this transformation.  This result is more
     general than the earlier results in that it does not rely on the
     two-and-one-half dimensional assumption.
\end{abstract}

\section{Introduction}
%%%%
Offset continuation (OC) is the operator that transforms common-offset
seismic reflection data to data with a different offset. Following the
classic results of \cite{GPR29-03-03740406},
\cite{GPR30-06-08130828,GPR32-06-10451073} described OC as a
continuous process of gradual change of the offset by means of a
partial differential equation. Because it is based on the small-offset
small-dip approximation, Bolondi's equation failed at large offsets or
steep reflector dips. Nevertheless, the OC concept inspired a flood of
research on dip moveout (DMO) correction
\cite[]{DMP00-00-01300130}. Since one can view DMO as a particular
case of OC (continuation to zero offset), the offset continuation
theory can serve as a natural basis for DMO theory. Its immediate
application is in interpolating data undersampled in the offset
dimension.  \par \cite{me,GEO68-02-07180732} introduced a
revised version of the OC differential equation and proved that it
provides the correct kinematics of the continued wavefield for any
offset and reflector dip under the assumption of constant effective
velocity. The equation is interpreted as an ``image wave equation'' by
\cite{hubral}.  Studying the laws of amplitude transformation shows
that in 2.5-D media the amplitudes of continued seismic gathers
transform according to the rules of geometric seismics, except for the
reflection coefficient, which remains unchanged
\cite[]{joint,GEO68-02-07180732}. The solution of the boundary problem
on the OC equation for the DMO case \cite[]{GEO68-02-07180732}
coincides in high-frequency asymptotics with the amplitude-preserving
DMO, also known as {\em Born DMO}
\cite[]{GEO56-02-01820189,SEG-1990-1366}.  However, for the purposes
of verifying that the amplitude is correct for any offset, this
derivation is incomplete.  \par In this paper, we perform a direct
test on the amplitude properties of the OC equation.  We describe the
input common-offset data by the Kirchhoff modeling integral, which
represents the high-frequency approximation of a reflected (scattered)
wavefield, recorded at the surface at nonzero offset \cite[]{norm}.
For reflected waves, the Kirchhoff approximation is accurate up to the
two orders in the high-frequency series (the ray series) for the
differential operator applied to the solution, with the first order
describing the phase function alone and the second order describing
the amplitude.  We prove that both orders of accuracy are satisfied
when the offset continuation equation is applied to Kirchhoff data.
Thus, this differential equation is the ``right'' equation to two
orders, producing the correct amplitude as well as the correct phase
for offset continuation.  That is, the geometric spreading effects and
curvature effects of the reflected data are properly transformed.  The
angularly dependent reflection coefficient of the original offset is
preserved.  \par This proof relates the OC equation with
``wave-equation'' processing.  It also provides additional
confirmation of the fact that the true-amplitude OC and DMO operators
\cite[]{GEO58-01-00470066,joint,santos,GEO63-02-05570573} do not
depend on the reflector curvature and can properly transform
reflections from arbitrarily shaped reflectors
\cite[]{Goldin.sep.67.171,GEO61-03-07590775,cwp}.  The latter result
was specifically a 2.5-D result, whereas the result of this paper does
not depend on the 2.5-D assumption.  That is, the result presented
here remains valid when the reflector has out-of-plane variation.
\par Our method of proof is indirect.  We first write the Kirchhoff
representation for the reflected wave in a form that can be easily
matched to the solution of the OC differential equation.  We then
present the analogues of the eikonal and transport equations for the
OC equation and show that the amplitude and phase of the Kirchhoff
representation satisfy those two equations.

\section{THE KIRCHHOFF MODELING APPROXIMATION}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
In this section, we introduce the Kirchhoff approximate integral
representation of the upward propagating response to a single
reflector, with separated source and receiver points.  We then show
how the amplitude of this integrand is related to the zero-offset
amplitude at the source receiver point on the ray, making equal angles
at the scattering point with the rays from the separated source and
receiver.  The Kirchhoff integral representation \cite[]{haddon,norm}
describes the wavefield scattered from a single reflector. This
representation is applicable in situations where the high-frequency
assumption is valid (the wavelength is smaller than the characteristic
dimensions of the model) and corresponds in accuracy to the WKBJ
approximation for reflected waves, including phase shifts through
buried foci.  The general form of the Kirchhoff modeling integral is
\begin{equation}
U_S({\bf r,s, \omega}) = \int_\Sigma\,R ({\bf x;r,s})\,
{\partial \over {\partial n}}\,\left[ 
U_I({\bf s, x ,\omega})\,G({\bf x,r,\omega})\right]\,
d\Sigma \; ,
\label{eqn:KI}
\end{equation}  
where ${\bf s} = (s,0,0)$ and ${\bf r} = (r,0,0)$ stand for the source
and the receiver location vectors at the surface of observation; ${\bf
x}$ denotes a point on the reflector surface $\Sigma$; $R $ is the
reflection coefficient at $\Sigma$; $n$ is the upward normal to the
reflector at the point ${\bf x}$; and $U_I$ and $G$ are the incident
wavefield and Green's function, respectively represented by their WKBJ
approximation,
\begin{equation}
U_I({\bf s,x,\omega}) = F(\omega)\,
A_s({\bf s,x})\,e^{i\omega\,\tau_s({\bf s,x})}\;,
\label{eqn:ui}
\end{equation}  
\begin{equation}
G({\bf x,r,\omega}) = A_r({\bf x,r})\,e^{i\omega\,\tau_r({\bf x,r})}\;.
\label{eqn:g}
\end{equation}
In this equation,
$\tau_s({\bf s,x})$ and $A_s({\bf s,x})$ are the traveltime and the
amplitude of the wave propagating from ${\bf s}$ to ${\bf x}$;
$\tau_r({\bf x,r})$ and $A_r({\bf x,r})$ are the corresponding
quantities for the wave propagating from ${\bf x}$ to ${\bf r}$; and
$F(\omega)$ is the spectrum of the input signal, assumed to be
the transform of a bandlimited impulsive source.  
In the time domain,
the Kirchhoff modeling integral transforms to
\begin{equation}
u_S({\bf r,s},t) = 
\int_\Sigma\,R ({\bf x;r,s})\,{\partial \over {\partial n}}
\left[A_s({\bf s,x})\,A_r({\bf x,r})\,
f\left(t- \tau_s({\bf s,x}) - \tau_r({\bf x,r})\right)\right]\,
d{\bf x}\;,
\label{eqn:KIT}
\end{equation} 
with $f$ denoting the inverse temporal transform of $F$.  The
reflection traveltime $\tau_{sr}$ corresponds physically to the
diffraction from a point diffractor located at the point ${\bf x}$ on
the surface $\Sigma$, and the amplitudes $A_s$ and $A_r$ are point
diffractor amplitudes, as well.
\par
The main goal of this paper is to test the compliance of
representation (\ref{eqn:KIT}) with the offset continuation differential
equation.  The OC equation contains the derivatives of the wavefield
with respect to the parameters of observation (${\bf s, r}$, and
$t$). According to the rules of classic calculus, these derivatives
can be taken under the sign of integration in formula
(\ref{eqn:KIT}). Furthermore, since we do not assume that the true-amplitude
OC operator affects the reflection coefficient $R $, the
offset-dependence of this coefficient is outside the scope of
consideration. Therefore, the only term to be considered as a trial
solution to the OC equation is the kernel of the Kirchhoff integral,
which is contained in the square brackets in equations (\ref{eqn:KI}) and
(\ref{eqn:KIT}) and has the form
\begin{equation}
k({\bf s,r,x},t) = A_{sr}({\bf s,r,x})\,
f\left(t - \tau_{sr}({\bf s,r,x})\right)\;,
\label{eqn:kernel}
\end{equation}
where
\begin{equation}
\tau_{sr}({\bf s,r,x}) =  \tau_s({\bf s,x}) + \tau_r({\bf x,r})\;,
\label{eqn:time}
\end{equation} 
\begin{equation}
A_{sr}({\bf s,r,x}) =  A_s({\bf s,x})\,A_r({\bf x,r})\;.
\label{eqn:amplitude}
\end{equation}
\par
In a 3-D medium with a constant velocity $v$, the traveltimes and
amplitudes have the simple explicit expressions
\begin{equation}
\tau_s({\bf s,x}) = {{\rho_s({\bf s,x})} \over v}\;,\;\;
\tau_r({\bf x,r}) = {{\rho_r({\bf x,r})} \over v}\;,
\label{eqn:taur}
\end{equation}
\begin{equation}
A_s({\bf s,x}) = {1 \over {4 \pi\,\rho_s({\bf s,x})}}\;,\;\;
A_r({\bf x,r}) = {1 \over {4 \pi\,\rho_r({\bf x,r})}}\;,
\label{eqn:ampr}
\end{equation}
where $\rho_s$ and $\rho_r$ are the lengths of the incident and reflected
rays, respectively (Figure \ref{fig:cwpgen}). If the reflector surface
$\Sigma$ is explicitly defined by some function $z=z({\bf x})$, then
\begin{equation}
\rho_s({\bf s,x}) = \sqrt{({\bf x-s})^2 + z^2({\bf x})}\;,\;\; 
\rho_r({\bf x,r}) = \sqrt{({\bf r-x})^2 + z^2({\bf x})}\;.
\label{eqn:lr}
\end{equation}

\inputdir{XFig}

\plot{cwpgen}{width=\textwidth}{Geometry of diffraction in a
constant velocity medium: view in the reflection plane.}

\par We then introduce a particular zero-offset amplitude, namely the
amplitude along the zero offset ray that bisects the angle between the
incident and reflected ray in this plane, as shown in Figure
\ref{fig:cwpgen}.  We denote the square of this amplitude as $A_0$.
That is,
\begin{equation}
A_0 = {1 \over {(4 \pi \rho_0 )^2}}\;.
\label{eqn:azero}
\end{equation}
$A_0$ is the amplitude factor that appears in the Kirchhoff integral
set up for a zero-offset reflection along the ray $\rho_0$. It is,
thus, the desired output factor inside the Kirchhoff integral after
DMO. As follows from formulas (\ref{eqn:amplitude}) and
(\ref{eqn:ampr}), the amplitude transformation in DMO (continuation to
zero offset) is characterized by the dimensionless ratio
\begin{equation}
{A_{sr} \over A_0} = {{\rho_0^2}\over {\rho_s\,\rho_r}}\;,
\label{eqn:ratio}
\end{equation}
where $\rho_0$ is the length of the zero-offset ray (Figure \ref{fig:cwpgen}).
\par
As follows from the simple trigonometry of the triangles, formed by
the incident and reflected rays (the law of cosines),
\begin{eqnarray} 
\sqrt{\rho_s^2 + \rho_0^2 - 2\,\rho_s\,\rho_0\,\cos{\gamma}} \,
+\, \sqrt{\rho_r^2 + \rho_0^2 - 2\,\rho_r\,\rho_0\,\cos{\gamma}}
 = 
\nonumber \\
= \sqrt{\rho_s^2 + \rho_r^2 - 2\,\rho_s\,\rho_r\,\cos{2\gamma}} \;,
\label{eqn:cos}
\end{eqnarray} 
where $\gamma$ is the reflection angle, as shown in the figure.
After straightforward
algebraic transformations of equation (\ref{eqn:cos}), we arrive at the
explicit relationship between the ray lengths:
\begin{equation}
{{(\rho_s + \rho_r)\,\rho_0} \over {2\,\rho_s\,\rho_r}} = 
\cos{\gamma}\;.
\label{eqn:r1r2}
\end{equation}
Substituting (\ref{eqn:r1r2}) into (\ref{eqn:ratio}) yields
\begin{equation} 
{A_{sr} \over A_0} = {\tau_0 \over \tau_{sr}}\,\cos{\gamma}\;,
\label{eqn:ratrat}
\end{equation}
where $\tau_0$ is the zero-offset two-way
traveltime ($\tau_0 = 2\,\rho_0/v$).
\par
What we have done is rewrite the finite-offset amplitude in the
Kirchhoff integral in terms of a particular zero-offset amplitude.
That zero-offset amplitude would arise as the geometric spreading
effect if there were a reflector whose dip was such that the
finite-offset pair would be specular at the scattering point.  Of
course, the zero-offset ray would also be specular in this case.
 
\section{THE OFFSET CONTINUATION EQUATION}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
In this section, we introduce the offset continuation partial
differential equation.  We then develop its WKBJ, or ray theoretic,
solution for phase and leading-order amplitude.  We explain how we
verify that the traveltime and amplitude of the integrand of the
Kirchhoff representation (\ref{eqn:KIT}) satisfy the ``eikonal'' and
``transport'' equations of the OC partial differential equation.  To
do so, we make use of relationship (\ref{eqn:ratrat}), derived from
the Kirchhoff integral.  \par The offset continuation differential
equation derived in earlier papers
\cite[]{me,GEO68-02-07180732}\footnote{To our knowledge, the first
derivation of the revised offset continuation equation was
accomplished by Joseph Higginbotham of Texaco in 1989.  Unfortunately,
Higginbotham's derivation never appeared in the open literature.} is
\begin{equation}
h \, \left( {\partial^2 P \over \partial y^2} - 
{\partial^2 P \over \partial h^2} \right) \, = \, 
t_n \, {\partial^2 P \over {\partial t_n \,\partial h}} \;. 
\label{eqn:OCequation} 
\end{equation}
In this equation, $h$ is the half-offset ($h = l/2$), $y$ is the midpoint
(${\bf y = (s + r)}/ 2$) [hence, $y = (r + s)/2$],
and $t_n$ is the NMO-corrected traveltime
\begin{equation}
t_n = \sqrt{t^2 - {{l^2} \over {v^2}}}\;.
\label{eqn:NMO}
\end{equation}
Equation (\ref{eqn:OCequation}) describes the process of
seismogram transformation in the time-midpoint-offset domain. One can
obtain the high-frequency asymptotics of its solution by standard
methods, as follows.
We introduce a trial asymptotic solution of the form
\begin{equation}
P\left(y,h,t_n\right) =
A_n(y,h)\,f\left(t_n-\tau_n(y,h)\right) \;.
\label{eqn:raymethod} 
\end{equation}
It is important to remember the assumption that $f$ is a
``rapidly varying function,'' for example, a bandlimited delta
function.
We substitute this solution
into equation (\ref{eqn:OCequation}) and collect the terms
in order of derivatives of $f$.
This is the direct counterpart of collecting terms in powers of
frequency when applying WKBJ in the frequency domain.
From the leading
asymptotic order (the second derivative of the function $f$), we
obtain the eikonal equation describing the kinematics of the OC
transformation:
\begin{equation}
h \, \left[     {\left( \partial \tau_n \over \partial y \right)}^2 - 
                {\left( \partial \tau_n \over \partial h \right)}^2
     \right] = \, - \, \tau_n \, {\partial \tau_n \over \partial h} \;.  
\label{eqn:eikonal} 
\end{equation}
In this equation, we have replaced a multiplier of $t_n$ by
$\tau_n$ on the right side of the equation.  This is consistent with
our assumption that $f$ is a bandlimited delta function or some
equivalent impulsive source.
Analogously, collecting the terms containing the first derivative of
$f$ leads to the transport equation describing the transformation
of the amplitudes:
\begin{equation}
\left( \tau_n - 2h \, {\partial \tau_n \over {\partial h}} \right)
\, {\partial A_n \over \partial h} + 2h {\partial \tau_n \over \partial
y}   {\partial A_n \over \partial y} + h A_n \left( {\partial^2 \tau_n
\over {\partial y^2}} - {\partial^2 \tau_n \over {\partial h^2}} 
\right) \, = \, 0 \;.
\label{eqn:transport} 
\end{equation}
\par
We then rewrite the eikonal equation (\ref{eqn:eikonal}) in the
time-source-receiver coordinate system, as follows:
\begin{equation}
\left( \tau_{sr}^2 + {{l^2} \over {v^2}} \right) \left( {\partial \tau_{sr}
\over \partial r} -   {\partial \tau_{sr} \over \partial s} \right) = 2 \,l\,
\tau_{sr} \left( {1 \over {v^2}} - {\partial \tau_{sr} \over \partial r}
{\partial \tau_{sr} \over \partial s} \right) \;,
\label{eqn:SCeikonal} 
\end{equation}
which makes it easy (using Mathematica) to verify that the explicit
expression for the phase of the Kirchhoff integral kernel (\ref{eqn:time})
satisfies the eikonal equation for any scattering point\footnote{Note
that the scattering point $\bf{x}$ plays the role of a set of
parameters in the partial differential equation for $\tau_{sr}$.  To
pass from a two-dimensional in-plane traveltime to a three-dimensional
traveltime, one need only replace $z^2$ with $x_2^2 + z^2$. The role
of $x = x_1$ remains unchanged in the solution.}  ${\bf x} = (x_1 ,
x_2 , z)$.  Here, $\tau_{sr}$ is related to $\tau_n$ as $t$ is related
to $t_n$ in equation (\ref{eqn:NMO}).
\par
The general solution of the amplitude equation (\ref{eqn:transport})
has the form \cite[]{GEO68-02-07180732}
\begin{equation}
A_n = A_0\,{{\tau_0\,\cos{\gamma}}\over{\tau_n}}\,
\left({1+\rho_0\,K}\over{\cos^2{\gamma}+\rho_0\,K}\right)^{1/2}\;,
\label{eqn:ampOC} 
\end{equation}
where $K$ is the reflector curvature at the reflection point. The
kernel (\ref{eqn:kernel}) of the Kirchhoff integral (\ref{eqn:KIT})
corresponds to the reflection from a point diffractor: the integral
realizes the superposition of Huygens secondary source contributions.
We can obtain the solution of the amplitude equation for this case by
formally setting the curvature $K$ to infinity (setting the radius of
curvature to zero). The infinite curvature transforms formula
(\ref{eqn:ampOC}) to the relationship
\begin{equation}
{A_n \over A_0} = {\tau_0 \over \tau_n}\,\cos{\gamma}\;.
\label{eqn:diffampOC} 
\end{equation}
\par
Again, we exploit the assumption that
the signal $f$ has the form of the delta function.
In this case, the amplitudes
before and after the NMO correction are connected according to the
known properties of the delta function, as follows:
\begin{equation}
A_{sr}\,\delta\left(t - \tau_{sr}({\bf s,r,x})\right)=
\left|{{\partial t_n} \over {\partial t}}\right|_{t=\tau_{sr}}\,
A_{sr}\,\delta\left(t_n - \tau_n({\bf s,r,x})\right)=
A_n\,\delta\left(t_n - \tau_n({\bf s,r,x})\right)\;,
\label{eqn:NMOkernel}
\end{equation}
with 
\begin{equation}
A_n = {\tau_{sr} \over \tau_n}\,A_{sr}\;.
\label{eqn:asr2an} 
\end{equation}
Combining equations (\ref{eqn:asr2an}) and (\ref{eqn:diffampOC}) yields
\begin{equation}
{A_{sr} \over A_0} = {\tau_0 \over \tau_{sr}}\,\cos{\gamma}\;,
\label{eqn:final} 
\end{equation}
which coincides exactly with the previously found formula
(\ref{eqn:ratrat}).  As with the solution of the eikonal equation, we pass
from an in-plane solution in two dimensions to a solution for a
scattering point in three dimensions by replacing $z^2$ with $x_2^2 +
z^2$.
\par
Although the presented equations pertain to the case of offset
continuation that starts from $h=0$, i.e., inverse DMO, this is
sufficient, since every other continuation can be obtained as a chain
of DMO and inverse DMO.
\par
Thus, it is apparent that the OC differential equation
(\ref{eqn:OCequation}) relates to the Kirchhoff representation of
reflection data. We see that the amplitude and phase of the Kirchhoff
representation for arbitrary offset is the point diffractor WKBJ
solution of the offset continuation differential equation.  Hence, the
Kirchhoff approximation is a solution of the OC differential equation
when we hold the reflection coefficient constant.  This means that the
solution of the OC differential equation has all the features of
amplitude preservation, as does the Kirchhoff representation,
including geometrical spreading, curvature effects, and phase shift
effects.  Furthermore, in the Kirchhoff representation and the
solution of the OC partial differential equation by WKBJ, we have not
used the 2.5-D assumption.  Therefore the preservation of amplitude is
not restricted to cylindrical surfaces as it is in the true-amplitude
proof for DMO \cite[]{cwp}.  This is what we sought to confirm.



\section{DISCUSSION}
%%%%%%%%%%%%%%%%%% 

We have proved that the offset continuation equation correctly
transforms common-offset seismic data modeled by the Kirchhoff
integral approximation. The kinematic and dynamic equivalence of the
OC equation has been proved previously by different methods
\cite[]{GEO68-02-07180732}. However, connecting this equation with
Kirchhoff modeling opens new insights into the theoretical basis of
DMO and offset continuation: 
\begin{enumerate} 

\item 
The Kirchhoff integral can serve as a link between the wave-equation
theory, conventionally used in seismic data processing, and the
kinematically derived OC equation. Though the analysis in this paper
follows the constant-velocity model, this link can be extended in
principle to handle the case of a variable background velocity.

\item 
The OC equation operates on the kernel of the Kirchhoff integral,
which is independent of the local dip and curvature of the
reflector. This proves that the true-amplitude OC and DMO operators
can properly transform reflections from curved reflectors.
Moreover, this result does not imply any special
orientation of the reflector curvature matrix. Therefore, it does
not require a commonly made 2.5-D assumption
\cite[]{cwp}. Implicitly, this fact proves the amplitude
preservation property of the three-dimensional azimuth moveout (AMO)
operator \cite[]{GEO63-02-05740588}, based on cascading the true-amplitude DMO
and inverse DMO operators.
\end{enumerate}

\section{Acknowledgments}
We thank the Center for Wave Phenomena Consortium Project at the
Colorado School of Mines and the Stanford Exploration Project at
Stanford University. We appreciate the encouragement of Fabio Rocca
regarding the analysis of the offset continuation partial differential
equation. Finally, we thank the anonymous reviewer for the 
helpful suggestions.

\bibliographystyle{seg}
\bibliography{SEP2,SEG,paper}



%%% Local Variables: 
%%% mode: latex
%%% TeX-master: t
%%% End: 
